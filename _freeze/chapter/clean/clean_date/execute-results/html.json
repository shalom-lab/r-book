{
  "hash": "aa4250261fbc493b92cbb143d0dfeec7",
  "result": {
    "engine": "knitr",
    "markdown": "# 最佳推荐-lubridate包\n\n该包属于tidyverse组成之一,用于日期和时间处理\n\n\n\n\n\n\n::: {.cell context='setup'}\n\n```{.r .cell-code}\nlibrary(tidyverse) # or library(lubridate)\n```\n:::\n\n\n\n\n\n\n## 基本用法\n\n### 字符串转日期\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nymd('20221221','2023-12-21','2023/2/21','20/2/21')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2022-12-21\" \"2023-12-21\" \"2023-02-21\" \"2020-02-21\"\n```\n\n\n:::\n\n```{.r .cell-code}\nmdy('12212022','12212023','12/21/2023','2/21/20')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2022-12-21\" \"2023-12-21\" \"2023-12-21\" \"2020-02-21\"\n```\n\n\n:::\n:::\n\n\n\n\n\n\n### 时间间隔\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninterval(ymd('2021-12-21'),ymd('20221221'))/years(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n\n```{.r .cell-code}\ninterval(ymd('2021-12-21'),ymd('20221221'))/months(3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n\n```{.r .cell-code}\ninterval(ymd('2021-12-21'),ymd('20221221'))/weeks(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 52.14286\n```\n\n\n:::\n\n```{.r .cell-code}\ninterval(ymd('2021-12-21'),ymd('20221221'))/days(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 365\n```\n\n\n:::\n:::\n\n\n\n\n\n\n### 年月提取\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nymd('2021-12-21') %>% year()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2021\n```\n\n\n:::\n\n```{.r .cell-code}\nymd('2021-12-21') %>% month()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 12\n```\n\n\n:::\n\n```{.r .cell-code}\nymd('2021-12-21') %>% week()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 51\n```\n\n\n:::\n\n```{.r .cell-code}\nymd('2021-12-21') %>% day()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 21\n```\n\n\n:::\n:::\n\n\n\n\n\n\n### 日期运算\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nymd('2021-12-21')+days(365)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2022-12-21\"\n```\n\n\n:::\n\n```{.r .cell-code}\nymd('2021-12-21')+weeks(52)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2022-12-20\"\n```\n\n\n:::\n\n```{.r .cell-code}\nymd('2021-12-21')+months(12)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2022-12-21\"\n```\n\n\n:::\n\n```{.r .cell-code}\nymd('2021-12-21')+years(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2022-12-21\"\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## 实战应用\n### 年龄计算\n\nHIS系统住院数据模拟，计算就诊年月周，就诊年龄，住院天数\n\n\n\n\n\n\n::: {.cell context='setup'}\n\n```{.r .cell-code}\ndata<-data.frame(id=1:6,birth_date=paste(2021,1,1:6,sep='-'),\n                 admit_date=paste(2023,5:10,6:1,sep='-'),\n                 disch_date=paste(2023,5:10,6:11,sep='-'))\ndata\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"birth_date\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"admit_date\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"disch_date\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"2021-1-1\",\"3\":\"2023-5-6\",\"4\":\"2023-5-6\"},{\"1\":\"2\",\"2\":\"2021-1-2\",\"3\":\"2023-6-5\",\"4\":\"2023-6-7\"},{\"1\":\"3\",\"2\":\"2021-1-3\",\"3\":\"2023-7-4\",\"4\":\"2023-7-8\"},{\"1\":\"4\",\"2\":\"2021-1-4\",\"3\":\"2023-8-3\",\"4\":\"2023-8-9\"},{\"1\":\"5\",\"2\":\"2021-1-5\",\"3\":\"2023-9-2\",\"4\":\"2023-9-10\"},{\"1\":\"6\",\"2\":\"2021-1-6\",\"3\":\"2023-10-1\",\"4\":\"2023-10-11\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n  mutate(birth_date=ymd(birth_date),\n         admit_date=ymd(admit_date),\n         disch_date=ymd(disch_date),\n         age=interval(birth_date,admit_date)/years(1),\n         los=interval(admit_date,disch_date)/days(1)) %>%\n  mutate(year=year(admit_date),\n         month=month(admit_date),\n         week=week(admit_date))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"birth_date\"],\"name\":[2],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"admit_date\"],\"name\":[3],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"disch_date\"],\"name\":[4],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"age\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"los\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"year\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"month\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"week\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"2021-01-01\",\"3\":\"2023-05-06\",\"4\":\"2023-05-06\",\"5\":\"2.342466\",\"6\":\"0\",\"7\":\"2023\",\"8\":\"5\",\"9\":\"18\"},{\"1\":\"2\",\"2\":\"2021-01-02\",\"3\":\"2023-06-05\",\"4\":\"2023-06-07\",\"5\":\"2.421918\",\"6\":\"2\",\"7\":\"2023\",\"8\":\"6\",\"9\":\"23\"},{\"1\":\"3\",\"2\":\"2021-01-03\",\"3\":\"2023-07-04\",\"4\":\"2023-07-08\",\"5\":\"2.498630\",\"6\":\"4\",\"7\":\"2023\",\"8\":\"7\",\"9\":\"27\"},{\"1\":\"4\",\"2\":\"2021-01-04\",\"3\":\"2023-08-03\",\"4\":\"2023-08-09\",\"5\":\"2.578082\",\"6\":\"6\",\"7\":\"2023\",\"8\":\"8\",\"9\":\"31\"},{\"1\":\"5\",\"2\":\"2021-01-05\",\"3\":\"2023-09-02\",\"4\":\"2023-09-10\",\"5\":\"2.657534\",\"6\":\"8\",\"7\":\"2023\",\"8\":\"9\",\"9\":\"35\"},{\"1\":\"6\",\"2\":\"2021-01-06\",\"3\":\"2023-10-01\",\"4\":\"2023-10-11\",\"5\":\"2.734247\",\"6\":\"10\",\"7\":\"2023\",\"8\":\"10\",\"9\":\"40\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\n\n## 基础包里的日期\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc(\"%Y\", \"%y\", \"%m\", \"%B\", \"%b\", \"%d\", \"%A\", \"%a\", \"%H\", \"%I\", \"%M\", \"%S\", \"%p\", \n  \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\", \"%X\") %>%\n  sapply(function(x){\n    format(Sys.time(),x)\n  }) %>% as.data.frame()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\".\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"2024\",\"_rn_\":\"%Y\"},{\"1\":\"24\",\"_rn_\":\"%y\"},{\"1\":\"11\",\"_rn_\":\"%m\"},{\"1\":\"十一月\",\"_rn_\":\"%B\"},{\"1\":\"11月\",\"_rn_\":\"%b\"},{\"1\":\"30\",\"_rn_\":\"%d\"},{\"1\":\"星期六\",\"_rn_\":\"%A\"},{\"1\":\"周六\",\"_rn_\":\"%a\"},{\"1\":\"18\",\"_rn_\":\"%H\"},{\"1\":\"06\",\"_rn_\":\"%I\"},{\"1\":\"53\",\"_rn_\":\"%M\"},{\"1\":\"01\",\"_rn_\":\"%S\"},{\"1\":\"下午\",\"_rn_\":\"%p\"},{\"1\":\"+0800\",\"_rn_\":\"%z\"},{\"1\":\"+08\",\"_rn_\":\"%Z\"},{\"1\":\"335\",\"_rn_\":\"%j\"},{\"1\":\"47\",\"_rn_\":\"%U\"},{\"1\":\"48\",\"_rn_\":\"%W\"},{\"1\":\"周六 11月 30 18:53:01 2024\",\"_rn_\":\"%c\"},{\"1\":\"2024/11/30\",\"_rn_\":\"%x\"},{\"1\":\"18:53:01\",\"_rn_\":\"%X\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}